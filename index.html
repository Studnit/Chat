<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aurus Certification Tracker Pro</title>

<style>
:root {
  --excel-green: #217346;
  --bg-color: #f4f7f6;
  --text-dark: #2c3e50;
  --border-color: #bdc3c7;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--bg-color); margin: 0; padding: 20px 20px 40px 40px;
}

h1 { margin: 0; color: var(--text-dark); }
.section-title {
  color: #2c3e50; margin-top: 30px; margin-bottom: 10px; font-size: 20px; display: flex; align-items: center; gap: 10px;
}

/* HEADER & DASHBOARD */
.header-container { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; }
.dashboard { display: flex; gap: 15px; margin-top: 12px; align-items: center; }
.stat-box {
  background: #fff; padding: 10px 18px; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); font-size: 14px; font-weight: bold; color: var(--text-dark); border-left: 5px solid #3498db;
}
.stat-box:nth-child(2) { border-left-color: #00c875; } 
.stat-box:nth-child(3) { border-left-color: #fdab3d; } 
.stat-box:nth-child(4) { border-left-color: #e2445c; } 

#autosave-indicator {
    font-size: 12px; color: #27ae60; font-weight: bold; opacity: 0; transition: 0.3s;
}

.controls { display: flex; gap: 10px; align-items: center; }
#searchInput { padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; width: 200px; outline: none; font-size: 14px; }
#searchInput:focus { border-color: #3498db; }

.main-btn {
  background: #3498db; color: #fff; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.2s;
}
.main-btn:hover { filter: brightness(1.1); }
.export-btn { background: var(--excel-green); }
.save-btn-admin { background: #2ecc71; display: none; } /* Hidden by default */

/* TABLE STYLES */
.table-wrapper {
  overflow-x: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-radius: 8px; background: #fff; max-height: 50vh; margin-bottom: 20px; padding-bottom: 5px;
}
.table-wrapper::-webkit-scrollbar { height: 12px; }
.table-wrapper::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 8px; }
.table-wrapper::-webkit-scrollbar-thumb { background: #bdc3c7; border-radius: 8px; border: 2px solid #f1f1f1;}

table { width: 100%; border-collapse: collapse; background: #fff; min-width: 1400px; }
th, td { border: 1px solid var(--border-color); padding: 8px 10px; font-size: 13px; text-align: center; white-space: nowrap; }
th { position: sticky; color: #fff; font-size: 14px; background: #34495e; top: 0; z-index: 3; }

/* COLORS */
.status-working { background: #fdab3d !important; color: #fff !important; font-weight: bold; }
.status-done { background: #00c875 !important; color: #fff !important; font-weight: bold; }
.status-stuck { background: #e2445c !important; color: #fff !important; font-weight: bold; }
.status-yet { background: #c4c4c4 !important; color: #fff !important; font-weight: bold; }
.week-yes { background: #2ecc71 !important; color: #fff; font-weight: bold; }
.week-no { background: #e74c3c !important; color: #fff; font-weight: bold; }

/* MODALS & CONTEXT */
.context-menu {
  position: absolute; background: #fff; border: 1px solid var(--border-color); box-shadow: 2px 4px 12px rgba(0,0,0,0.2);
  z-index: 10000; border-radius: 6px; padding: 8px 0; min-width: 200px; list-style: none; margin: 0; display: none;
}
.context-menu li { padding: 8px 20px; font-size: 13px; cursor: pointer; color: #2c3e50; display: flex; align-items: center; gap: 10px;}
.context-menu li:hover { background: #f4f7f6; color: #3498db; }

#toast {
  visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 5px; padding: 16px; position: fixed; z-index: 2000; left: 50%; bottom: 30px; transform: translateX(-50%); opacity: 0; transition: 0.3s;
}
#toast.show { visibility: visible; opacity: 1; bottom: 50px; }
</style>
</head>

<body>

<div id="toast">Notification text</div>

<div class="header-container">
  <div>
    <h1>Aurus Certification Tracker</h1>
    <div class="dashboard">
      <div class="stat-box">üìä Total: <span id="statTotal">0</span></div>
      <div class="stat-box">‚úÖ Done: <span id="statComp">0</span></div>
      <div class="stat-box">‚è≥ Working: <span id="statProg">0</span></div>
      <div class="stat-box">üõë Stuck: <span id="statStuck">0</span></div>
      <span id="autosave-indicator">‚òÅÔ∏è Autosaved</span>
    </div>
  </div>
  <div class="controls">
    <button id="manualSaveBtn" class="main-btn save-btn-admin" onclick="saveData()">üíæ Save Now</button>
    <button class="main-btn export-btn" onclick="exportCSV()">üì§ Export CSV</button>
    <input type="text" id="searchInput" placeholder="üîç Global Search..." oninput="renderBodies()">
    <button id="adminBtn" class="main-btn" onclick="toggleAdmin()">üîí Enable Admin Mode</button>
  </div>
</div>

<h2 class="section-title">‚è≥ In-Progress Projects</h2>
<div class="table-wrapper">
    <table id="inProgressTable"><thead></thead><tbody id="tbody-inprogress"></tbody></table>
</div>

<h2 class="section-title">‚úÖ Completed Projects</h2>
<div class="table-wrapper">
    <table id="completedTable"><thead></thead><tbody id="tbody-completed"></tbody></table>
</div>

<script>
// CONFIG
const teamMembersList = ["Nitesh Kharose", "Harshal Chaudhari", "Hemantkumar Nikole", "Nagamani Gatti", "Vaishnavi Mate"];
const initialHeaders = ["SR NO", "EP ID", "Certification Name", "Start Date", "End Date", "Project Status", "Developer Name", "Team Lead Name", "Last Week", "9‚Äì13 Feb"];

// INITIAL DATA
const rawInitialData = [
    ["1","EP-0128","Chase ISO Wiseasy R1 PTS V6","21/09/25","17/02/26","Working on it","Sakshi Gudmewar","Vrushabh Munde","YES","YES"],
    ["12","EP-0165","Chase Stratus Store and Forward","05/12/25","12/02/26","Done","Gaurav Shitole","Gaurav Shitole","","YES"]
];

// STATE
let HEADERS = localStorage.getItem("trackerHeaders_v8") ? JSON.parse(localStorage.getItem("trackerHeaders_v8")) : [...initialHeaders];
let DATA = localStorage.getItem("trackerData_v8") ? JSON.parse(localStorage.getItem("trackerData_v8")) : JSON.parse(JSON.stringify(rawInitialData));
let FORMATS = localStorage.getItem("trackerFormats_v8") ? JSON.parse(localStorage.getItem("trackerFormats_v8")) : {};
let COLUMN_META = { 5: { type: 'dropdown', options: ['Working on it', 'Done', 'Stuck', 'Yet to Start'] } };

let admin = false;
let autosaveTimer;

// CORE FUNCTIONS
function toggleAdmin() {
    if(!admin){
        if(prompt("Admin Password:") !== "admin123") return;
        admin = true;
        document.getElementById("adminBtn").innerText = "üîì Exit Admin";
        document.getElementById("manualSaveBtn").style.display = "block";
        showToast("Admin Mode On");
    } else {
        admin = false;
        document.getElementById("adminBtn").innerText = "üîí Enable Admin Mode";
        document.getElementById("manualSaveBtn").style.display = "none";
    }
    renderBodies(); renderHeaders();
}

function renderHeaders() {
    ['inProgressTable', 'completedTable'].forEach(tid => {
        const thead = document.querySelector(`#${tid} thead`);
        thead.innerHTML = `<tr>${HEADERS.map(h => `<th>${h}</th>`).join('')}</tr>`;
    });
}

function renderBodies() {
    const tbProg = document.getElementById("tbody-inprogress");
    const tbComp = document.getElementById("tbody-completed");
    tbProg.innerHTML = ""; tbComp.innerHTML = "";
    
    let stats = { total: 0, comp: 0, prog: 0, stuck: 0 };

    DATA.forEach((r, idx) => {
        const status = r[5] ? r[5].toUpperCase() : "";
        const isDone = status === "DONE";
        
        if(isDone) stats.comp++; else if(status === "STUCK") stats.stuck++; else stats.prog++;
        stats.total++;

        const tr = document.createElement("tr");
        tr.innerHTML = r.map((cell, cIdx) => {
            let editable = admin && cIdx !== 5 ? 'contenteditable="true"' : '';
            let cls = "";
            if(cIdx === 5) {
                if(status === "DONE") cls = "status-done";
                else if(status === "STUCK") cls = "status-stuck";
                else cls = "status-working";
            }
            
            // Dropdown for Status
            if(admin && cIdx === 5) {
                return `<td class="${cls}"><select onchange="updateCell(this.value, ${idx}, 5)">
                    <option value="Working on it" ${r[5]==='Working on it'?'selected':''}>Working</option>
                    <option value="Done" ${r[5]==='Done'?'selected':''}>Done</option>
                    <option value="Stuck" ${r[5]==='Stuck'?'selected':''}>Stuck</option>
                </select></td>`;
            }

            return `<td ${editable} class="${cls}" oninput="handleInput(${idx}, ${cIdx}, this)">${cell}</td>`;
        }).join('');
        
        if(isDone) tbComp.appendChild(tr); else tbProg.appendChild(tr);
    });

    document.getElementById("statTotal").innerText = stats.total;
    document.getElementById("statComp").innerText = stats.comp;
    document.getElementById("statProg").innerText = stats.prog;
    document.getElementById("statStuck").innerText = stats.stuck;
}

// AUTOSAVE LOGIC
function handleInput(rIdx, cIdx, el) {
    if(!admin) return;
    
    // Update local data
    DATA[rIdx][cIdx] = el.innerText;
    
    // Reset Timer for 2 seconds
    clearTimeout(autosaveTimer);
    autosaveTimer = setTimeout(() => {
        saveData(true); // true means it's an autosave
    }, 2000);
}

function updateCell(val, rIdx, cIdx) {
    DATA[rIdx][cIdx] = val;
    renderBodies();
    saveData(true);
}

function saveData(isAutosave = false) {
    localStorage.setItem("trackerData_v8", JSON.stringify(DATA));
    localStorage.setItem("trackerHeaders_v8", JSON.stringify(HEADERS));
    
    if(isAutosave) {
        const indicator = document.getElementById("autosave-indicator");
        indicator.style.opacity = "1";
        setTimeout(() => indicator.style.opacity = "0", 1500);
    } else {
        showToast("üíæ Changes Saved Successfully!");
    }
}

function showToast(msg) {
    const t = document.getElementById("toast");
    t.innerText = msg; t.className = "show";
    setTimeout(() => t.className = "", 3000);
}

function exportCSV() {
    let csv = HEADERS.join(",") + "\n" + DATA.map(r => r.join(",")).join("\n");
    const a = document.createElement("a");
    a.href = URL.createObjectURL(new Blob([csv], {type: "text/csv"}));
    a.download = "Aurus_Tracker.csv"; a.click();
}

renderHeaders(); renderBodies();
</script>
</body>
</html>
