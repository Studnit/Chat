<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aurus Certification Tracker Pro</title>

<style>
/* ---------------- ROOT ---------------- */
:root {
  --excel-green: #217346;
  --bg-color: #f4f7f6;
  --text-dark: #2c3e50;
  --border-color: #bdc3c7;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--bg-color);
  margin: 0;
  padding: 20px 20px 40px 40px;
}

h1 { margin: 0; color: var(--text-dark); }

/* ---------------- HEADER ---------------- */
.header-container {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  margin-bottom: 20px;
}

.controls { display: flex; gap: 10px; align-items: center; }

.main-btn {
  background: #3498db;
  color: #fff;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}

.export-btn { background: var(--excel-green); }

#searchInput {
  padding: 10px;
  border: 1px solid var(--border-color);
  border-radius: 5px;
  width: 200px;
}

/* ---------------- AUTOSAVE INDICATOR ---------------- */
#autosaveIndicator {
  display: none;
  font-size: 12px;
  font-weight: bold;
  margin-left: 10px;
}
#autosaveIndicator.saving { color: #f39c12; }
#autosaveIndicator.saved { color: #27ae60; }

/* ---------------- DASHBOARD ---------------- */
.dashboard {
  display: flex;
  gap: 15px;
  margin-top: 12px;
}

.stat-box {
  background: #fff;
  padding: 10px 18px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: bold;
  border-left: 5px solid #3498db;
}

.stat-box:nth-child(2){border-left-color:#00c875}
.stat-box:nth-child(3){border-left-color:#fdab3d}
.stat-box:nth-child(4){border-left-color:#e2445c}

/* ---------------- TABLE ---------------- */
.table-wrapper {
  overflow-x: auto;
  background: #fff;
  border-radius: 8px;
  margin-bottom: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
  min-width: 1400px;
}

th, td {
  border: 1px solid var(--border-color);
  padding: 8px 10px;
  font-size: 13px;
  text-align: center;
  white-space: nowrap;
}

th {
  background: #34495e;
  color: #fff;
  position: sticky;
  top: 0;
}

td[contenteditable="true"]:focus {
  outline: 3px solid var(--excel-green);
  outline-offset: -2px;
}

/* ---------------- STATUS COLORS ---------------- */
.status-working{background:#fdab3d!important;color:#fff;font-weight:bold}
.status-done{background:#00c875!important;color:#fff;font-weight:bold}
.status-stuck{background:#e2445c!important;color:#fff;font-weight:bold}
.status-yet{background:#c4c4c4!important;color:#fff;font-weight:bold}

.week-yes{background:#2ecc71!important;color:#fff;font-weight:bold}
.week-no{background:#e74c3c!important;color:#fff;font-weight:bold}
.week-na{background:#f1c40f!important;font-weight:bold}
.week-waiting{background:#aed6f1!important;font-weight:bold}

/* ---------------- DROPDOWN ---------------- */
select.dynamic-dropdown {
  width: 100%;
  border: none;
  background: transparent;
  font-weight: bold;
  cursor: pointer;
}

/* ---------------- TOAST ---------------- */
#toast {
  visibility: hidden;
  min-width: 250px;
  background: #333;
  color: #fff;
  text-align: center;
  border-radius: 5px;
  padding: 16px;
  position: fixed;
  left: 50%;
  bottom: 30px;
  transform: translateX(-50%);
  font-weight: bold;
}
#toast.show { visibility: visible; }
</style>
</head>

<body>

<div id="toast">Saved</div>

<div class="header-container">
  <div>
    <h1>Aurus Certification Tracker</h1>
    <div class="dashboard">
      <div class="stat-box">üìä Total: <span id="statTotal">0</span></div>
      <div class="stat-box">‚úÖ Done: <span id="statComp">0</span></div>
      <div class="stat-box">‚è≥ Working: <span id="statProg">0</span></div>
      <div class="stat-box">üõë Stuck: <span id="statStuck">0</span></div>
    </div>
  </div>

  <div class="controls">
    <button class="main-btn export-btn" onclick="exportCSV()">üì§ Export CSV</button>
    <input id="searchInput" placeholder="üîç Search..." oninput="renderBodies()">
    <button id="adminBtn" class="main-btn" onclick="toggleAdmin()">üîí Enable Admin</button>
    <span id="autosaveIndicator">‚òÅÔ∏è Saving‚Ä¶</span>
  </div>
</div>

<h3>‚è≥ In-Progress & Queued</h3>
<div class="table-wrapper">
<table id="inProgressTable"><thead></thead><tbody id="tbody-inprogress"></tbody></table>
</div>

<h3>‚úÖ Completed</h3>
<div class="table-wrapper">
<table id="completedTable"><thead></thead><tbody id="tbody-completed"></tbody></table>
</div>

<script>
/* ---------------- DATA ---------------- */
const initialHeaders = ["SR NO","EP ID","Certification Name","Start Date","End Date","Project Status","Developer Name","Team Lead Name","Last Week","9‚Äì13 Feb"];

const initialMeta = {
  3:{type:'date'},4:{type:'date'},
  5:{type:'dropdown',options:['Working on it','Done','Stuck','Yet to Start']},
  8:{type:'dropdown',options:['YES','NO','NA','Waiting']},
  9:{type:'dropdown',options:['YES','NO','NA','Waiting']}
};

const rawInitialData = JSON.parse(localStorage.getItem("trackerData_v8")) || [
  ["1","EP-0128","Chase ISO Wiseasy","21/09/25","17/02/26","Working on it","Sakshi","Vrushabh","YES","YES"]
];

let HEADERS = initialHeaders;
let DATA = rawInitialData;
let COLUMN_META = initialMeta;
let admin = false;

/* ---------------- AUTOSAVE ---------------- */
let autosaveTimer=null, autosaveDirty=false;
function markDirty(){
  if(!admin)return;
  autosaveDirty=true;
  const el=document.getElementById("autosaveIndicator");
  el.style.display="inline";
  el.textContent="‚òÅÔ∏è Saving‚Ä¶";
  el.className="saving";
  clearTimeout(autosaveTimer);
  autosaveTimer=setTimeout(()=>{
    if(autosaveDirty){
      saveData();
      autosaveDirty=false;
      el.textContent="‚òÅÔ∏è Cloud Autosaved ‚úì";
      el.className="saved";
      setTimeout(()=>el.style.display="none",2000);
    }
  },2000);
}

/* ---------------- RENDER ---------------- */
function renderHeaders(){
  ["inProgressTable","completedTable"].forEach(id=>{
    document.querySelector(`#${id} thead`).innerHTML =
      "<tr>"+HEADERS.map(h=>`<th>${h}</th>`).join("")+"</tr>";
  });
}

function renderBodies(){
  const tbP=document.getElementById("tbody-inprogress");
  const tbC=document.getElementById("tbody-completed");
  tbP.innerHTML=""; tbC.innerHTML="";

  let total=0,done=0,prog=0,stuck=0;
  const statusIdx=HEADERS.indexOf("Project Status");
  const q=document.getElementById("searchInput").value.toLowerCase();

  DATA.forEach((r,i)=>{
    if(q && !r.join(" ").toLowerCase().includes(q))return;
    const isDone=r[statusIdx]==="Done";
    let tr=document.createElement("tr");

    r.forEach((c,j)=>{
      let td=document.createElement("td");
      let meta=COLUMN_META[j]||{type:'text'};
      td.innerText=c;

      if(admin && meta.type==="text") td.contentEditable=true;
      if(meta.type==="dropdown" && admin){
        let sel=document.createElement("select");
        sel.className="dynamic-dropdown";
        meta.options.forEach(o=>{
          let op=document.createElement("option");
          op.value=o;op.text=o;
          if(o===c)op.selected=true;
          sel.appendChild(op);
        });
        sel.onchange=()=>{DATA[i][j]=sel.value;markDirty();renderBodies();}
        td.innerHTML="";td.appendChild(sel);
      }

      if(j===statusIdx){
        if(c==="Working on it")td.className="status-working";
        if(c==="Done")td.className="status-done";
        if(c==="Stuck")td.className="status-stuck";
        if(c==="Yet to Start")td.className="status-yet";
      }

      td.oninput=()=>{DATA[i][j]=td.innerText;markDirty();}
      tr.appendChild(td);
    });

    total++;
    if(isDone){done++;tbC.appendChild(tr);}
    else{prog++;tbP.appendChild(tr);}
  });

  document.getElementById("statTotal").innerText=total;
  document.getElementById("statComp").innerText=done;
  document.getElementById("statProg").innerText=prog;
  document.getElementById("statStuck").innerText=stuck;
}

/* ---------------- ADMIN ---------------- */
function toggleAdmin(){
  if(!admin){
    if(prompt("Admin Password")!=="admin123")return;
    admin=true;
    adminBtn.innerText="üîì Exit Admin";
  }else{
    admin=false;
    adminBtn.innerText="üîí Enable Admin";
    document.getElementById("autosaveIndicator").style.display="none";
  }
  renderBodies();
}

/* ---------------- STORAGE ---------------- */
function saveData(){
  localStorage.setItem("trackerData_v8",JSON.stringify(DATA));
}

function exportCSV(){
  let csv=HEADERS.join(",")+"\n";
  DATA.forEach(r=>csv+=r.join(",")+"\n");
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="Aurus_Tracker.csv";
  a.click();
}

/* ---------------- INIT ---------------- */
renderHeaders();
renderBodies();
</script>

</body>
</html>
