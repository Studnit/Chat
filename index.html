<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aurus Certification Tracker Pro</title>

<style>
:root {
  --excel-green: #217346;
  --bg-color: #f4f7f6;
  --text-dark: #2c3e50;
  --border-color: #bdc3c7;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--bg-color); margin: 0; padding: 20px 20px 40px 40px;
}

h1 { margin: 0; color: var(--text-dark); }
.section-title {
  color: #2c3e50; margin-top: 30px; margin-bottom: 10px; font-size: 20px; display: flex; align-items: center; gap: 10px;
}

/* HEADER & DASHBOARD */
.header-container { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; }
.dashboard { display: flex; gap: 15px; margin-top: 12px; align-items: center; }
.stat-box {
  background: #fff; padding: 10px 18px; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); font-size: 14px; font-weight: bold; color: var(--text-dark); border-left: 5px solid #3498db;
}
.stat-box:nth-child(2) { border-left-color: #00c875; } 
.stat-box:nth-child(3) { border-left-color: #fdab3d; } 
.stat-box:nth-child(4) { border-left-color: #e2445c; } 

#autosaveIndicator {
  font-size: 12px; color: #27ae60; font-weight: bold; opacity: 0; transition: opacity 0.3s; margin-left: 10px;
}

.controls { display: flex; gap: 10px; align-items: center; }
#searchInput { padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; width: 200px; outline: none; font-size: 14px; }
#searchInput:focus { border-color: #3498db; }

.main-btn {
  background: #3498db; color: #fff; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.2s;
}
.main-btn:hover { filter: brightness(1.1); }
.export-btn { background: var(--excel-green); }
#adminSaveBtn { background: #2ecc71; display: none; }

/* TABLE & SCROLLER */
.table-wrapper {
  overflow-x: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-radius: 8px; background: #fff; max-height: 50vh; margin-bottom: 20px; padding-bottom: 5px;
}
.table-wrapper::-webkit-scrollbar { height: 12px; }
.table-wrapper::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 8px; margin: 0 10px; }
.table-wrapper::-webkit-scrollbar-thumb { background: #bdc3c7; border-radius: 8px; border: 2px solid #f1f1f1;}
.table-wrapper::-webkit-scrollbar-thumb:hover { background: #95a5a6; }

table { width: 100%; border-collapse: collapse; background: #fff; min-width: 1400px; }
th, td { border: 1px solid var(--border-color); padding: 8px 10px; font-size: 13px; text-align: center; white-space: nowrap; }
th { position: sticky; color: #fff; font-size: 14px; box-shadow: 0 2px 2px -1px rgba(0,0,0,0.4); z-index: 3; }

.sort-header th { height: 35px; top: 0; cursor: pointer; user-select: none; background: #34495e; }
.filter-row th { top: 55px; background: #ecf0f1 !important; padding: 5px; border-top: none; z-index: 2;}

/* COLORS */
.status-working { background: #fdab3d !important; color: #fff !important; font-weight: bold; }
.status-done { background: #00c875 !important; color: #fff !important; font-weight: bold; }
.status-stuck { background: #e2445c !important; color: #fff !important; font-weight: bold; }
.status-yet { background: #c4c4c4 !important; color: #fff !important; font-weight: bold; }
.week-yes { background: #2ecc71 !important; color: #fff; font-weight: bold; }
.week-no { background: #e74c3c !important; color: #fff; font-weight: bold; }
.week-na { background: #f1c40f !important; font-weight: bold; }
.week-waiting { background: #aed6f1 !important; font-weight: bold; }

select.dynamic-dropdown {
  width: 100%; height: 100%; border: none; font-weight: inherit; color: inherit; font-family: inherit; font-size: inherit;
  background: transparent; outline: none; cursor: pointer; appearance: none; text-align: center;
}

td[contenteditable="true"]:focus { outline: 3px solid var(--excel-green); outline-offset: -2px; }
tr.active-row td { filter: brightness(0.92); }

/* CONTEXT MENU */
.context-menu {
  position: absolute; background: #fff; border: 1px solid var(--border-color); box-shadow: 2px 4px 12px rgba(0,0,0,0.2);
  z-index: 10000; border-radius: 6px; padding: 8px 0; min-width: 200px; list-style: none; margin: 0; display: none;
}
.context-menu li { padding: 8px 20px; font-size: 13px; cursor: pointer; color: #2c3e50; font-weight: 500; display: flex; align-items: center; gap: 10px;}
.context-menu li:hover { background: #f4f7f6; color: #3498db; }
.context-menu li.danger { color: #e74c3c; }

/* MODALS */
.modal-overlay {
  display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.5); z-index: 10001; align-items: center; justify-content: center;
}
.modal-box { background: #fff; padding: 25px; border-radius: 8px; width: 350px; }
.modal-actions { margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; }

#toast {
  visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 5px; padding: 16px; position: fixed; z-index: 2000; left: 50%; bottom: 30px; transform: translateX(-50%); opacity: 0; transition: 0.3s;
}
#toast.show { visibility: visible; opacity: 1; bottom: 50px; }
</style>
</head>

<body>

<div id="toast">Notification text</div>

<div id="colSettingsModal" class="modal-overlay">
  <div class="modal-box">
    <h3>‚öôÔ∏è Column Settings</h3>
    <p id="modalColName" style="margin:0; font-size:13px; color:#3498db; font-weight:bold;"></p>
    <label>Data Type:</label>
    <select id="colTypeSelect" onchange="toggleDropdownOptions()" style="width:100%; padding:8px; margin-top:10px;">
      <option value="text">üìù Free Text</option>
      <option value="date">üìÖ Date Picker</option>
      <option value="dropdown">üîΩ Dropdown</option>
    </select>
    <div id="dropdownOptionsDiv" style="display:none; margin-top:10px;">
      <label>Options (comma separated):</label>
      <input type="text" id="colDropdownOptions" style="width:100%; padding:8px;">
    </div>
    <div class="modal-actions">
      <button class="main-btn" style="background:#bdc3c7" onclick="closeModal()">Cancel</button>
      <button class="main-btn" style="background:#27ae60" onclick="saveColumnSettings()">Save</button>
    </div>
  </div>
</div>

<ul id="contextMenu" class="context-menu">
  <li onclick="renameColumnContext()">‚úèÔ∏è Rename Column</li>
  <li onclick="openColumnSettingsContext()">‚öôÔ∏è Column Type</li>
  <hr>
  <li onclick="addColumnContext(0)">‚ûï Column Left</li>
  <li onclick="addColumnContext(1)">‚ûï Column Right</li>
  <li class="danger" onclick="deleteColumnContext()">üóëÔ∏è Delete Column</li>
  <hr>
  <li onclick="addRowContext(0)">‚¨ÜÔ∏è Row Above</li>
  <li onclick="addRowContext(1)">‚¨áÔ∏è Row Below</li>
  <li class="danger" onclick="deleteRowContext()">üóëÔ∏è Delete Row</li>
  <li onclick="moveRowContext(-1)">üîº Move Up</li>
  <li onclick="moveRowContext(1)">üîΩ Move Down</li>
</ul>

<div class="header-container">
  <div>
    <h1>Aurus Certification Tracker</h1>
    <div class="dashboard">
      <div class="stat-box">üìä Total: <span id="statTotal">0</span></div>
      <div class="stat-box">‚úÖ Done: <span id="statComp">0</span></div>
      <div class="stat-box">‚è≥ Working: <span id="statProg">0</span></div>
      <div class="stat-box">üõë Stuck: <span id="statStuck">0</span></div>
      <span id="autosaveIndicator">‚òÅÔ∏è Autosaved</span>
    </div>
  </div>
  <div class="controls">
    <button id="adminSaveBtn" class="main-btn" onclick="saveData()">üíæ Save Now</button>
    <button class="main-btn export-btn" onclick="exportCSV()">üì§ Export CSV</button>
    <input type="text" id="searchInput" placeholder="üîç Global Search..." oninput="renderBodies()">
    <button id="adminBtn" class="main-btn" onclick="toggleAdmin()">üîí Enable Admin Mode</button>
  </div>
</div>

<h2 class="section-title">‚è≥ In-Progress & Queued Projects</h2>
<div class="table-wrapper"><table id="inProgressTable"><thead></thead><tbody id="tbody-inprogress"></tbody></table></div>

<h2 class="section-title">‚úÖ Completed Projects</h2>
<div class="table-wrapper"><table id="completedTable"><thead></thead><tbody id="tbody-completed"></tbody></table></div>

<script>
// INITIAL DATA
const initialHeaders = ["SR NO", "EP ID", "Certification Name", "Start Date", "End Date", "Project Status", "Developer Name", "Team Lead Name", "Last Week", "9‚Äì13 Feb"];
const rawInitialData = [
    ["1","EP-0128","Chase ISO Wiseasy R1 PTS V6 [04157999]","21/09/25","17/02/26","Working on it","Sakshi Gudmewar","Vrushabh Munde","YES","YES"],
    ["12","EP-0165","Chase Stratus Store and Forward","05/12/25","12/02/26","Done","Gaurav Shitole","Gaurav Shitole","","YES"]
];

// STATE
let HEADERS = localStorage.getItem("trackerHeaders_v8") ? JSON.parse(localStorage.getItem("trackerHeaders_v8")) : [...initialHeaders];
let DATA = localStorage.getItem("trackerData_v8") ? JSON.parse(localStorage.getItem("trackerData_v8")) : JSON.parse(JSON.stringify(rawInitialData));
let FORMATS = localStorage.getItem("trackerFormats_v8") ? JSON.parse(localStorage.getItem("trackerFormats_v8")) : {};
let COLUMN_META = localStorage.getItem("trackerColMeta_v8") ? JSON.parse(localStorage.getItem("trackerColMeta_v8")) : {
    5: { type: 'dropdown', options: ['Working on it', 'Done', 'Stuck', 'Yet to Start'] },
    8: { type: 'dropdown', options: ['YES', 'NO', 'NA', 'Waiting'] },
    9: { type: 'dropdown', options: ['YES', 'NO', 'NA', 'Waiting'] }
};

let admin = false, contextTarget = null, activeRow = null, autosaveTimer = null;

// NOTIFICATIONS
function showToast(msg, type="success") {
    const toast = document.getElementById("toast");
    toast.innerText = msg;
    toast.style.background = type === "success" ? "#27ae60" : "#e74c3c";
    toast.className = "show";
    setTimeout(() => toast.className = "", 3000);
}

function triggerAutosave() {
    if(!admin) return;
    clearTimeout(autosaveTimer);
    autosaveTimer = setTimeout(() => saveData(true), 2000);
}

function saveData(isAutosave = false) {
    localStorage.setItem("trackerHeaders_v8", JSON.stringify(HEADERS));
    localStorage.setItem("trackerData_v8", JSON.stringify(DATA));
    localStorage.setItem("trackerFormats_v8", JSON.stringify(FORMATS));
    localStorage.setItem("trackerColMeta_v8", JSON.stringify(COLUMN_META));
    
    if(isAutosave) {
        const ind = document.getElementById("autosaveIndicator");
        ind.style.opacity = "1";
        setTimeout(() => ind.style.opacity = "0", 1500);
    } else {
        showToast("üíæ Manual Save Complete");
    }
}

// UI LOGIC
function toggleAdmin() {
    if(!admin) {
        if(prompt("Password:") !== "admin123") return showToast("Incorrect!", "error");
        admin = true;
        document.getElementById("adminBtn").innerText = "üîì Exit Admin";
        document.getElementById("adminSaveBtn").style.display = "block";
        showToast("Admin Mode Enabled");
    } else {
        admin = false;
        document.getElementById("adminBtn").innerText = "üîí Enable Admin Mode";
        document.getElementById("adminSaveBtn").style.display = "none";
        showToast("Admin Mode Disabled");
    }
    renderHeaders(); renderBodies();
}

function renderHeaders() {
    ['inProgressTable', 'completedTable'].forEach(tid => {
        const thead = document.querySelector(`#${tid} thead`);
        thead.innerHTML = `<tr class="sort-header">${HEADERS.map(h => `<th>${h}</th>`).join('')}</tr>`;
    });
}

function renderBodies() {
    const tbProg = document.getElementById("tbody-inprogress");
    const tbComp = document.getElementById("tbody-completed");
    tbProg.innerHTML = ""; tbComp.innerHTML = "";
    
    let stats = { total: 0, comp: 0, prog: 0, stuck: 0 };

    DATA.forEach((r, idx) => {
        const status = (r[5] || "").toUpperCase();
        const isDone = status === "DONE";
        
        if(isDone) stats.comp++; else if(status === "STUCK") stats.stuck++; else stats.prog++;
        stats.total++;

        const tr = document.createElement("tr");
        tr.dataset.index = idx;
        tr.innerHTML = r.map((cell, cIdx) => {
            let colMeta = COLUMN_META[cIdx] || { type: 'text' };
            let cls = "";
            if(cIdx === 5) {
                if(status === "DONE") cls = "status-done";
                else if(status === "STUCK") cls = "status-stuck";
                else cls = "status-working";
            }
            
            if(admin) {
                if(colMeta.type === 'dropdown') {
                    const opts = colMeta.options || [];
                    return `<td class="${cls}"><select class="dynamic-dropdown" onchange="updateCell(${idx}, ${cIdx}, this.value)">
                        <option value=""></option>${opts.map(o => `<option value="${o}" ${o===cell?'selected':''}>${o}</option>`).join('')}
                    </select></td>`;
                }
                return `<td contenteditable="true" class="${cls}" oninput="updateCell(${idx}, ${cIdx}, this.innerText)">${cell}</td>`;
            }
            return `<td class="${cls}">${cell}</td>`;
        }).join('');
        
        if(isDone) tbComp.appendChild(tr); else tbProg.appendChild(tr);
    });

    document.getElementById("statTotal").innerText = stats.total;
    document.getElementById("statComp").innerText = stats.comp;
    document.getElementById("statProg").innerText = stats.prog;
    document.getElementById("statStuck").innerText = stats.stuck;
}

function updateCell(rIdx, cIdx, val) {
    DATA[rIdx][cIdx] = val;
    if(cIdx === 5) renderBodies();
    triggerAutosave();
}

// CONTEXT MENU ACTIONS
document.addEventListener('contextmenu', e => {
    if(!admin) return;
    const td = e.target.closest('td');
    const th = e.target.closest('th');
    if(td || th) {
        e.preventDefault();
        contextTarget = td || th;
        const menu = document.getElementById("contextMenu");
        menu.style.display = "block";
        menu.style.left = e.pageX + "px";
        menu.style.top = e.pageY + "px";
        activeRow = td ? td.parentElement : null;
    }
});

document.addEventListener('click', () => document.getElementById("contextMenu").style.display = "none");

function addRowContext(offset) {
    const idx = parseInt(activeRow.dataset.index) + offset;
    DATA.splice(idx, 0, Array(HEADERS.length).fill(""));
    showToast("Row Added");
    renderBodies(); triggerAutosave();
}

function deleteRowContext() {
    if(confirm("Delete this row?")) {
        DATA.splice(parseInt(activeRow.dataset.index), 1);
        showToast("Row Deleted", "error");
        renderBodies(); triggerAutosave();
    }
}

function moveRowContext(dir) {
    const idx = parseInt(activeRow.dataset.index);
    const target = idx + dir;
    if(target >= 0 && target < DATA.length) {
        [DATA[idx], DATA[target]] = [DATA[target], DATA[idx]];
        showToast("Row Moved");
        renderBodies(); triggerAutosave();
    }
}

function addColumnContext(offset) {
    const idx = contextTarget.cellIndex + offset;
    const name = prompt("Column Name:");
    if(name) {
        HEADERS.splice(idx, 0, name);
        DATA.forEach(r => r.splice(idx, 0, ""));
        showToast("Column Added");
        renderHeaders(); renderBodies(); triggerAutosave();
    }
}

function deleteColumnContext() {
    const idx = contextTarget.cellIndex;
    if(confirm(`Delete column "${HEADERS[idx]}"?`)) {
        HEADERS.splice(idx, 1);
        DATA.forEach(r => r.splice(idx, 1));
        showToast("Column Deleted", "error");
        renderHeaders(); renderBodies(); triggerAutosave();
    }
}

function renameColumnContext() {
    const idx = contextTarget.cellIndex;
    const name = prompt("New Name:", HEADERS[idx]);
    if(name) {
        HEADERS[idx] = name;
        showToast("Column Renamed");
        renderHeaders(); triggerAutosave();
    }
}

// SETTINGS
function openColumnSettingsContext() {
    const idx = contextTarget.cellIndex;
    document.getElementById("modalColName").innerText = HEADERS[idx];
    document.getElementById("colSettingsModal").style.display = "flex";
}

function closeModal() { document.getElementById("colSettingsModal").style.display = "none"; }

function toggleDropdownOptions() {
    document.getElementById("dropdownOptionsDiv").style.display = document.getElementById("colTypeSelect").value === 'dropdown' ? 'block' : 'none';
}

function saveColumnSettings() {
    const idx = Array.from(contextTarget.parentElement.children).indexOf(contextTarget);
    const type = document.getElementById("colTypeSelect").value;
    COLUMN_META[idx] = { type: type };
    if(type === 'dropdown') {
        COLUMN_META[idx].options = document.getElementById("colDropdownOptions").value.split(',').map(s => s.trim());
    }
    showToast("Type Updated");
    closeModal(); renderBodies(); triggerAutosave();
}

function exportCSV() {
    let csv = HEADERS.join(",") + "\n" + DATA.map(r => r.join(",")).join("\n");
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'Aurus_Tracker.csv'; a.click();
    showToast("üìä CSV Exported");
}

renderHeaders(); renderBodies();
</script>
</body>
</html>
